<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iostat 命令详解 · Hammer's Blog</title><meta name="description" content="iostat 命令详解 - Hammer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.newbeeee.com/atom.xml" title="Hammer's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/flapjackegg" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/#" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iostat 命令详解</h1><div class="post-info">Apr 23, 2018</div><div class="post-content"><h2 id="命令简介"><a href="#命令简介" class="headerlink" title="命令简介"></a>命令简介</h2><blockquote>
<p> iostat，用于报告中央处理器（CPU）统计信息和整个系统、适配器、tty 设备、磁盘和 CD-ROM 的输入/输出统计信息。</p>
</blockquote>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><h2 id="常用命令参数"><a href="#常用命令参数" class="headerlink" title="常用命令参数"></a>常用命令参数</h2><blockquote>
<p>-c 显示CPU使用情况<br>-d 显示磁盘使用情况<br>-k 以 KB 为单位显示<br>-m 以 M 为单位显示<br>-N 显示磁盘阵列(LVM) 信息<br>-n 显示NFS 使用情况<br>-p[磁盘] 显示磁盘和分区的情况<br>-t 显示终端和CPU的信息<br>-x 显示详细信息<br>-V 显示版本信息</p>
</blockquote>
<a id="more"></a>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>常用的方法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看 磁盘信息 每 1秒刷新一次 共 5次</span><br><span class="line">iostat  -dm 1 5</span><br><span class="line"># 查看 磁盘详细信息</span><br><span class="line">iostat -dmx</span><br><span class="line"># 查看 CPU 信息</span><br><span class="line">iostat -c</span><br></pre></td></tr></table></figure></p>
<h2 id="各项值的含义"><a href="#各项值的含义" class="headerlink" title="各项值的含义"></a>各项值的含义</h2><h3 id="cpu属性值说明："><a href="#cpu属性值说明：" class="headerlink" title="cpu属性值说明："></a>cpu属性值说明：</h3><p><code>%user</code> CPU处在用户模式下的时间百分比。<br><code>%nice</code> CPU处在带NICE值的用户模式下的时间百分比。<br><code>%system</code> CPU处在系统模式下的时间百分比。<br><code>%iowait</code> CPU等待输入输出完成时间的百分比。<br><code>%steal</code> 管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。<br><code>%idle</code> CPU空闲时间百分比。</p>
<h3 id="io-值说明"><a href="#io-值说明" class="headerlink" title="io 值说明"></a>io 值说明</h3><ul>
<li><code>rrqm/s</code> 每秒这个设备相关的读取请求有多少被Merge了 <strong>当系统调用需要读取数据的时候，VFS将请求发到各个FS，如果FS发现不同的读取请求读取的是相同Block的数据，FS会将这个请求合并Merge</strong></li>
<li><code>wrqm/s</code>每秒这个设备相关的写入请求有多少被Merge了。</li>
<li><code>r/s</code> 每秒完成的读 I/O 设备次数 即 <code>delta(rio)/s</code></li>
<li><code>w/s</code> 每秒完成的写 I/O 设备次数 即 <code>delta(wio)/s</code></li>
<li><code>rsec/s</code> 每秒读取的扇区数 即 <code>delta(rsect)/s</code></li>
<li><code>wsec/s</code> 每秒写入的扇区数 即 <code>delta(wsect)/s</code></li>
<li><code>rkB/s</code> 每秒读K字节数.是 rsect/s 的一半,因为每扇区大小为512字节</li>
<li><code>wkB/s</code> 每秒写K字节数.是 wsect/s 的一半.(需要计算)</li>
<li><code>avgrq-sz</code> 平均每次设备I/O操作的数据大小 (扇区) delta(rsect+wsect)/delta(rio+wio)</li>
<li><code>avgqu-sz</code> 平均I/O队列长度 即 delta(aveq)/s/1000 (因为aveq的单位为毫秒).<br><code>await</code> 平均每次设备I/O操作的等待时间 (毫秒).即 delta(ruse+wuse)/delta(rio+wio)<br><code>svctm</code> 平均每次设备I/O操作的服务时间 (毫秒).即 delta(use)/delta(rio+wio)<br><code>%util</code> 一秒中有百分之多少的时间用于 I/O 操作,或者说一秒中有多少时间 I/O 队列是非空的，即 delta(use)/s/1000 (因为use的单位为毫秒)</li>
</ul>
<p><strong>备注：</strong> 如果 %util 接近 100%，说明产生的I/O请求太多，I/O系统已经满负荷，该磁盘可能存在瓶颈。如果 svctm 比较接近 await，说明 I/O 几乎没有等待时间；如果 await 远大于 svctm，说明I/O 队列太长，io响应太慢，则需要进行必要优化。如果avgqu-sz比较大，也表示有当量io在等待。idle小于70% IO压力就较大了，一般读取速度有较多的wait。</p>
<p>同时可以结合vmstat 查看查看b参数(等待资源的进程数)和wa参数(IO等待所占用的CPU时间的百分比，高过30%时IO压力高)。<br>        另外 await 的参数也要多和 svctm 来参考。差的过高就一定有 IO 的问题。avgqu-sz 也是个做 IO 调优时需要注意的地方，这个就是直接每次操作的数据的大小，如果次数多，但数据拿的小的话，其实 IO 也会很小。如果数据拿的大，才IO 的数据会高。也可以通过 avgqu-sz × ( r/s or w/s ) = rsec/s or wsec/s。也就是讲，读定速度是这个来决定的。<br>svctm 一般要小于 await (因为同时等待的请求的等待时间被重复计算了)，svctm 的大小一般和磁盘性能有关，CPU/内存的负荷也会对其有影响，请求过多也会间接导致 svctm 的增加。await 的大小一般取决于服务时间(svctm) 以及 I/O 队列的长度和 I/O 请求的发出模式。如果 svctm 比较接近 await，说明 I/O 几乎没有等待时间；如果 await 远大于 svctm，说明 I/O 队列太长，应用得到的响应时间变慢，如果响应时间超过了用户可以容许的范围，这时可以考虑更换更快的磁盘，调整内核 elevator 算法，优化应用，或者升级 CPU。</p>
<h2 id="dm设备"><a href="#dm设备" class="headerlink" title="dm设备"></a>dm设备</h2><p>使用iostat查看磁盘io状态时，Device列显示了多个dm-xxx，这个dm 设备到底是什么呢<br><code>sar -d 1</code> 这个命令可以查看 dm 设备详细信息<br>可以知道dm-0、dm-1、dm-2的主设备号是253（是linux内核留给本地使用的设备号），次设备号分别是0、1、2，这类设备在/dev/mapper中</p>
<p>可以使用 <code>ll /dev/mapper/</code> 或者 <code>dmsetup ls</code> 命令来查看设备名</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/14/世界第八大奇迹-复利/" class="prev">PREV</a><a href="/2018/04/16/2018-04-16-hexo + github pages 搭建静态博客/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://blog.newbeeee.com">Hammer</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>